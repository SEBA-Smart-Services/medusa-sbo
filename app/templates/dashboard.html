{% extends "layout-empty.html" %}
{% block content %}
  <div class="mdl-cell mdl-cell--12-col mdl-typography--text-center">
    {% if allsites == True %}
      <h3>Overview</h3>
    {% else %}
      <h3>Overview</h3>
    {% endif %}
  </div>
  <div class="mdl-grid">

    <div class="mdl-cell mdl-cell--4-col mdl-cell--1-offset mdl-grid">

      <div class="mdl-cell mdl-cell--6-col mdl-shadow--4dp mdl-typography--text-center">
        <div class="mdl-card__title"><h2 class="mdl-card__title-text">Total Issues</h2></div>
        <h1 style="font-size: 700%">{{ num_results }}</h1>
      </div>

      <div class="mdl-cell mdl-cell--6-col mdl-shadow--4dp mdl-typography--text-center">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Average asset health</h2>
        </div>
        <div>
          <svg width="90%" height="90%" viewBox="0 0 1 1">
            <g id="piechart">
              <circle cx=0.5 cy=0.5 r=0.44 stroke="blue" stroke-width="0.09" stroke-dasharray="3" stroke-dashoffset="{{2.5-avg_health*2.5}}" fill="none" transform='rotate(-90 0.5 0.5)'/>
              <circle class="circle_animation" cx=0.5 cy=0.5 r=0.44 stroke="white" stroke-width="0.1" fill="none" transform='rotate(-90 0.5 0.5)'/>
            </g>
            <text x="0.5" y="0.5" font-family="Roboto" font-size="0.2" fill="#888" text-anchor="middle" dy="0.1">{{(avg_health*100)|round(1)}}%</text>
          </svg>
        </div>
        <br><br>
      </div>

      <div class="mdl-cell mdl-cell--12-col mdl-shadow--4dp mdl-typography--text-center">
        <div class="mdl-card__title"><h2 class="mdl-card__title-text">Alarms</h2></div>
        <div id="chart_div" style="width:92.5%; padding-left:5%"></div>
      </div>

    </div>

    <div class="mdl-cell mdl-cell--6-col">
      <div class="mdl-cell mdl-cell--12-col mdl-shadow--4dp mdl-typography--text-center">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Top issues</h2>
        </div>
        <table class="mdl-data-table mdl-js-data-table" style="width:100%;table-layout:fixed;white-space: normal;">
          <thead>
            <tr>
              {% if allsites == True %}
              <th class="mdl-data-table__cell--non-numeric">Site</th>
              {% endif %}
              <th class="mdl-data-table__cell--non-numeric">Asset</th>
              <th class="mdl-data-table__cell--non-numeric" style="width:45%">Algorithm</th>
              <th class="mdl-data-table__cell--non-numeric">Notes</th>
              <th>Priority</th>
            </tr>
          </thead>
          <tbody>
            {% for result in results %}
            {% if allsites == True or result.asset.site.name == site.name %}
            <tr>
              {% if allsites == True %}
              <td class="mdl-data-table__cell--non-numeric">{{result.asset.site.name}}</td>
              {% endif %}
              <td class="mdl-data-table__cell--non-numeric">{{result.asset.name}}</td>
              <td class="mdl-data-table__cell--non-numeric">{{result.algorithm.descr}}</td>
              <td class="mdl-data-table__cell--non-numeric">{{result.notes}}</td>
              <td>{{result.asset.priority}}</td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="position: fixed; left: -1000px; height: -1000px;">
  </svg>


  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
  google.charts.load('current', {packages: ['corechart', 'bar']});
  google.charts.setOnLoadCallback(drawAnnotations);

  function drawAnnotations() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Number of Alarms');

  	data.addRows([
  	{% for row in alarmcount %}
    		['{{ row[0] }}', {{ row[1] }}],
  	{% endfor %}
  	]);

        var options = {
          colors: ['red'],
          width: '100%',
          height: '100%',
          hAxis: {
            title: 'Week',
          },
          vAxis: {
            title: 'Number of Alarms'
          },
          legend: {position: 'none'}
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }
  </script>
{% endblock %}
