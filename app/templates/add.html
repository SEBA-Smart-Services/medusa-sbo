{% extends "layout.html" %}
{% block content %}
  <h2>Add Asset</h2>
  <form action="{{ url_for('add_asset_submit', sitename=site.name) }}" method=post>
    Type:
    <select name=type id=type_list>
      {% for asset_type in asset_types %}
        <option value="{{asset_type.name}}">{{asset_type.name}}</option>
      {% endfor %}
    </select>
    <br>
    Subtype:
    <select name=subtype id=subtype_list>
    </select>
    <br>
    Name: <input type=text size=30 name=name><br>
    Location: <input type=text size=30 name=location><br>
    Group: <input type=text size=30 name=group><br>
    <br>
    Components:<br>
    <div id=component_section>
    </div>
    <br>
    Exclude Algorithms:<br>
    <div id=exclusion_section>
    </div>
    <br>
    <input type=submit value=Submit>
  </form>
  <script type="text/javascript">
    $(function() {

      $('#type_list').prop("selectedIndex", -1);

      $('#type_list').change(function() {
        $.getJSON($SCRIPT_ROOT + '{{ url_for('return_subtypes', sitename=site.name) }}', {
          type: $('select[name="type"]').val(),
        }, function(data) {
          var subtype_list = $('#subtype_list');
          subtype_list.html('');
          $.each(data, function() {
            subtype_list.append($('<option />').val(this).text(this));
          })
          subtype_list.prop("selectedIndex", -1);
        });
        return false;
      });

      $('#subtype_list').change(function() {

        $.getJSON($SCRIPT_ROOT + '{{ url_for('return_components', sitename=site.name) }}', {
          type: $('select[name="type"]').val(),
          subtype: $('select[name="subtype"]').val(),
        }, function(component_data) {

          $.getJSON($SCRIPT_ROOT + '{{ url_for('return_loggedentities', sitename=site.name) }}', {
            type: $('select[name="type"]').val(),
          }, function(loggedentity_data) {

            var $loglist = $('<select name=log class=dropdown></select>')
            $.each(loggedentity_data, function() {
              $loglist.append($('<option />').val(this).text(this));
            })

            var component_section = $('#component_section');
            component_section.html('');
            var i = 1;
            $.each(component_data, function() {
              component_section.append($('<input type="checkbox" class="component" checked/>').val(this).attr('name', 'component' + i));
              component_section.append(this + '<br>');
              component_section.append($loglist.clone().attr('name', 'log' + i));
              component_section.append('<br>');
              i = i + 1;
            })
            
            $('.dropdown').prop("selectedIndex", -1)

          });

        });

        $.getJSON($SCRIPT_ROOT + '{{ url_for('return_exclusions', sitename=site.name) }}', {
          type: $('select[name="type"]').val(),
          subtype: $('select[name="subtype"]').val(),
        }, function(data) {
          var exclusion_section = $('#exclusion_section')
          exclusion_section.html('')
          $.each(data, function() {
            exclusion_section.append($('<input type="checkbox" name="exclusion" checked/>').val(this));
            exclusion_section.append(this+'<br>');
          })
        });

        return false;
      });

    });
  </script>
{% endblock %}