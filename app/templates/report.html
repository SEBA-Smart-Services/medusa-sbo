{% extends "layout.html" %}
{% block content %}
  <h2 class="centered">Site Report - {{site.name}}</h2>
  <br>
  {% for asset in assets %}
    <h3>{{asset.name}}</h3>
    <h4>Details</h4>

    <b>Location:</b> {{asset.location}}
    <br>
    <b>Group:</b> {{asset.group}}
    <br>
    <b>Priority:</b> {{asset.priority}}
    <br>
    <b>Notes:</b>
    <br>
    {{asset.notes}}

    <h4>Unresolved Issues</h4>
    <form action="{{ url_for('asset_issues_submit', sitename=site.name, asset_id=asset.id) }}" method=post>
      <table class="mdl-data-table mdl-js-data-table full-width">
        <thead>
          <tr>
            <th class="mdl-data-table__cell--non-numeric">First Failure</th>
            <th class="mdl-data-table__cell--non-numeric">Algorithm</th>
            <th>Passed</th>
            <th>Result</th>
            <th class="mdl-data-table__cell--non-numeric">Notes</th>
            <th>Acknowledged</th>
          </tr>
        </thead>
        <tbody>
          {% for result in unresolved_results[asset] %}
            <tr>
              <td class="mdl-data-table__cell--non-numeric">{{result.first_timestamp.strftime('%Y-%m-%d %H:%M:%S')}}</td>
              <td class="mdl-data-table__cell--non-numeric">{{result.algorithm.descr}}</td>
              <td>{{result.passed}}</td>

              {% if result.algorithm.algorithm.format == 'bool' %}
              <td>{{result.value != 0}}</td>
              {% else %}
              <td>{{result.algorithm.algorithm.format.format(result.value)}}</td>
              {% endif %}

              <td class="notes mdl-data-table__cell--non-numeric">{{result.notes}}</td>
              <td>
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect mdl-data-table__select" for="acknowledge-{{result.id}}">
                  <input type="checkbox" name="acknowledge" id="acknowledge-{{result.id}}" value="{{result.id}}" class="mdl-checkbox__input" {% if result.acknowledged %}checked{% endif %}/>
                </label>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    <h4>Most Recent Check</h4>
    <table class="mdl-data-table mdl-js-data-table full-width">
      <thead>
        <tr>
          <th class="mdl-data-table__cell--non-numeric">Timestamp</th>
          <th class="mdl-data-table__cell--non-numeric">Algorithm</th>
          <th>Passed</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody>
        {% for result in recent_results[asset] %}
          <tr>
            <td class="mdl-data-table__cell--non-numeric">{{result.recent_timestamp.strftime('%Y-%m-%d %H:%M:%S')}}</td>
            <td class="mdl-data-table__cell--non-numeric">{{result.algorithm.descr}}</td>
            <td>{{result.passed}}</td>

            {% if result.algorithm.algorithm.format == 'bool' %}
            <td>{{result.value != 0}}</td>
            {% else %}
            <td>{{result.algorithm.algorithm.format.format(result.value)}}</td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <br><br><br>
  {% endfor %}

{% endblock %}
